

# 1.skywalking线程池插件，TID 全局显示，解决lambada问题？

- skywalking官方插件已支持对线程池的织入,会去织入业务方自己实现的Runnable类，在执行run()方法之前去传递context。
  使用方法：
	修改 skywalking-agent.jar所在目录的 config/agent.config文件，在里面修改/添加配置
```
	#他将会去把指定包下所有`Runnable`的实现类给织入，可以前缀匹配
	jdkthreading.threading_class_prefixes=com.chy
```
然后在plugins文件夹里加入插件apm-jdk-threading-plugin.jar就能够使用了(如果是下载官方编译好的插件，apm-jdk-threading-plugin.jar被放在了bootstrap-plugins文件夹中，移动到plugins即可)

缺点：
虽然简单但是却有一个缺点，无法使用lambda表达式，比如下面的代码，就无法正常的把链路给连接起来
如果使用lambda去实现的Runnable类，虽然会生成一个匿名内部类，但是这个匿名内部类的和skywalking-agent使用的不同的类加载器，导致skywalking-agent无法去修改lambda表达式生成的Runnable的实现类.

- TID异步线程传递：
    若是使用便捷的CompletableFuture,建议使用 SupplierWrapper、RunnableWrapper、CallableWrapper。进行织入。 或者指定线程实现类 加上 @TraceCrossThread注解。
    ```
        CompletableFuture.supplyAsync(SupplierWrapper.of(()->{
                    return "SupplierWrapper";
            })).thenAccept(System.out::println);
    ```
















