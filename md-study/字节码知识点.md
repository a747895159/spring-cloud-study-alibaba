



# 1.bytebuddy 字节码增强原理,  skywalking 底层使用的
https://blog.csdn.net/wanxiaoderen/article/details/107079741?spm=1001.2014.3001.5501

本身就是 java 命令的一个参数（即 -javaagent）。-javaagent 参数之后需要指定一个 jar 包，这个 jar 包需要同时满足下面两个条件：
在 META-INF 目录下的 MANIFEST.MF 文件中必须指定 premain-class 配置项。
premain-class 配置项指定的类必须提供了 premain() 方法。
在 Java 虚拟机启动时，执行 main() 函数之前，虚拟机会先找到 -javaagent 命令指定 jar 包，然后执行 premain-class 中的 premain() 方法。用一句概括其功能的话就是：main() 函数之前的一个拦截器。



rebasing：对应 ByteBuddy.rebasing() 方法。当使用 rebasing 方式增强一个类时，Byte Buddy 保存目标类中所有方法的实现，也就是说，当 Byte Buddy 遇到冲突的字段或方法时，会将原来的字段或方法实现复制到具有兼容签名的重新命名的私有方法中，而不会抛弃这些字段和方法实现。从而达到不丢失实现的目的。
redefinition：对应 ByteBuddy.redefine() 方法。当重定义一个类时，Byte Buddy 可以对一个已有的类添加属性和方法，或者删除已经存在的方法实现。如果使用其他的方法实现替换已经存在的方法实现，则原来存在的方法实现就会消失。



# 2.Java代码生成库
- Java Proxy: JDK自带的一个代理工具，它允许为实现一系列接口的类代理类。要求目标类必须实现一个接口。
- CGLIB: 早起Java类库，也是强大的库,很复杂，后续维护类度差。
- Javassist :使用对开发者来说非常友好的,它使用Java源代码字符串和Javassist提供的简单API，共同拼凑出用户的Java类。Javassist自带编译器,性能上比不上Javac。在动态组合字符串以实现比较复杂的逻辑容器出错。
- Byte Buddy : 提供一种非常灵活且强大的领域特定语言,通过编写简单的Java代码即可创建自定义的运行时类。
    - subclass：对应 ByteBuddy.subclass() 方法, 生成目标类的子类。在子类方法中插入动态代码。
    - rebasing：对应 ByteBuddy.rebasing() 方法。当使用 rebasing 方式增强一个类时，Byte Buddy 保存目标类中所有方法的实现，也就是说，当 Byte Buddy 遇到冲突的字段或方法时，会将原来的字段或方法实现复制到具有兼容签名的重新命名的私有方法中，而不会抛弃这些字段和方法实现。从而达到不丢失实现的目的。
    - redefinition：对应 ByteBuddy.redefine() 方法。当重定义一个类时，Byte Buddy 可以对一个已有的类添加属性和方法，或者删除已经存在的方法实现。如果使用其他的方法实现替换已经存在的方法实现，则原来存在的方法实现就会消失。

