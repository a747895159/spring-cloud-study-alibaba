
稳定性全系列
https://blog.csdn.net/manzhizhen/article/details/103642565

### 1. 高性能实践方案

- 分布式部署，通过负载均衡分担单机压力。
- 多层次缓存，包括静态数据使用 CDN、本地缓存、分布式缓存等，以及处理缓存场景中的热点 key、缓存穿透、缓存并发、数据一致性等问题。
- 数据库和索引优化，以及利用搜索引擎解决复杂查询问题。
- 考虑使用 NoSQL 数据库，如 HBase、TiDB 等，但团队需熟悉这些组件并具备强大的运维能力。
- 异步处理，将次要流程通过多线程、消息队列、甚至延时任务进行异步处理。
- 流量控制，考虑业务是否允许限流（如秒杀场景），包括前端限流、Nginx 接入层限流、服务端限流。
- 流量削峰填谷，通过消息队列接收流量。
- 并发处理，通过多线程将串行逻辑并行化。
- 预计算，如抢红包场景，可提前计算红包金额并缓存，发红包时直接使用。
- 缓存预热，通过异步任务提前将数据预热到本地缓存或分布式缓存中。
- 减少 IO 次数，如数据库和缓存的批量读写、RPC 的批量接口支持、或通过冗余数据减少 RPC 调用。
- 减少 IO 时的数据包大小，包括采用轻量级通信协议、合适的数据结构、去除接口中多余字段、减少缓存 key 大小、压缩缓存 value 等。
- 优化程序逻辑，如将高概率阻断执行流程的判断逻辑前置、For 循环计算逻辑优化，或采用更高效算法。
- 使用各种池化技术，如 HTTP 请求池、线程池（考虑 CPU 密集型或 IO 密集型设置核心参数）、数据库和 Redis 连接池等。
- JVM 优化，包括新生代和老年代的大小、GC 算法选择等，以减少 GC 频率和耗时。
- 锁策略选择，读多写少场景使用乐观锁，或考虑通过分段锁减少锁冲突。

### 2. 高可用实践方案

- 节点故障转移，Nginx 和服务治理框架支持故障节点切换到另一个节点。
- 非对等节点的故障转移，通过心跳检测并实施主备切换（如 Redis 哨兵模式或集群模式、MySQL 主从切换等）。
- 设置接口层的超时、重试策略和幂等设计。
- 降级处理，保证核心服务，牺牲非核心服务，必要时进行熔断；或核心链路出问题时，有备选链路。
- 流量控制，对超过系统处理能力的请求直接拒绝或返回错误码。
- 消息队列的可靠性保证，包括生产者端的重试机制、消息代理的持久化、消费者端的 ack 机制等。
- 灰度发布，支持按机器维度进行小流量部署，观察系统日志和业务指标，运行稳定后再推全量。
- 监控报警，包括基础 CPU、内存、磁盘、网络 监控，以及 Web 服务器、JVM、数据库、各类中间件监控和业务指标监控。
- 灾备演练，类似当前的“混沌工程”，对系统进行破坏性手段，观察局部故障是否会引起可用性问题。

高可用方案主要从冗余、取舍、系统运维三个方向考虑，同时需有配套的值班机制和故障处理流程，当出现线上问题时，可及时跟进处理。



### 3.按照二八法则来推算 1000w 用户的访问量,计算QPS

让我们回归最初的问题：1000W并发，需部署多少个节点？

假设我们没有历史数据可以参考，我们可以采用**二八定律** 来进行估算。

* 假设有 1000W 用户，每天访问网站的用户占比为 20%，那么每天大约有 200W 用户访问。
* 假设每个用户平均点击 50 次，那么总的页面浏览量 PV=1 亿。
* 一天有 24 小时，根据二八定律，每天大部分用户活跃的时间点集中在(24 /* 0.2) 约等于 5 个小时以内，而大部分用户指的是（1 亿点击 /* 80%）约等于 8000W（PV）， 意味着在 5 个小时以内，大概会有 8000W 点击进来，也就是每秒大约有 4500(8000W/5 小时)个请求。
* 4500 只是一个平均数值。在这 5 小时内，请求量并不一定均匀，可能会出现大量用户集中访问的情况（比如像淘宝这样的网站，日访问量高峰时间段集中在下午 14:00 和晚上 21:00，其中 21:00 是一天中访问量的最高峰）。通常情况下，访问量高峰时段的请求量是平均请求量的 3 到 4 倍（这是一个经验值），我们按照 4 倍来计算。那么在这 5 小时内，可能会出现每秒 18000 个请求的情况。因此，问题由原本的支撑 1000W 用户，变成了一个具体的问题，**就是服务器端需要能够支撑每秒 18000 个请求** （QPS=18000）

![](https://img-blog.csdnimg.cn/d840ccaaa2414b1eb180de5a81e26396.png)

![](https://img-blog.csdnimg.cn/ae3fa90dd82c40acb80cb93dbed42290.png)



### 4.接口狂刷的主要防护措施：
- 交互式验证 :  	验证码验证；人机验证(先完成简单任务,在类似滑块或者识别图中的文字等)
- 安全参数校验：	请求参数中追加时间戳,随机字符串参与签名
- 使用HTTPS:		保证数据传输中不被篡改或窃取
- 用户访问认证	基于登录Token，防止非法请求
- 资源访问授权	基于访问资源权限进行精准控制
- 访问限流		防止过多请求导致系统崩溃
- IP封禁			将IP加入黑名单
- 日志监控与分析,进行统计预警 	使用开源工具Prometheus、Grafana、告警通知方式进行预警，及时运维防范。


